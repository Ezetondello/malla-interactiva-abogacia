<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Malla</title>

  <style>
    :root{
      --bg1:#fde7f0;
      --bg2:#f9d6e5;

      --panel: rgba(255,255,255,.70);
      --panel2: rgba(255,255,255,.55);
      --border: rgba(139,74,100,.16);
      --shadow: 0 18px 45px rgba(139,74,100,.12);

      --title:#8b4a64;
      --text:#4a3a45;

      --pill:#ffffff;
      --pillBorder: rgba(139,74,100,.18);

      --doneBg: rgba(233,251,242,.85);
      --doneBorder: rgba(120,185,150,.35);

      --progressTrack: rgba(139,74,100,.12);
      --progressFill: rgba(183,110,138,.65);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 100%);
      color: var(--text);
    }

    .wrap{
      max-width: 1200px;
      margin: 26px auto 60px;
      padding: 0 18px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;

      padding: 12px 14px;
      border-radius: 18px;
      background: var(--panel);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    /* Barra de progreso */
    .progressWrap{
      flex: 1 1 520px;
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 240px;
    }

    .progressTrack{
      height: 12px;
      width: 100%;
      background: var(--progressTrack);
      border-radius: 999px;
      overflow:hidden;
      border: 1px solid rgba(139,74,100,.10);
    }

    .progressFill{
      height:100%;
      width:0%;
      background: var(--progressFill);
      border-radius: 999px;
      transition: width .25s ease;
    }

    .pct{
      font-weight: 850;
      color: var(--title);
      font-size: 12px;
      min-width: 44px;
      text-align:right;
    }

    /* Bot√≥n reset sin texto */
    .iconBtn{
      width: 38px;
      height: 38px;
      border-radius: 999px;
      border: 1px solid rgba(139,74,100,.18);
      background: rgba(255,255,255,.75);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 16px;
      line-height: 1;
      transition: opacity .18s ease;
      user-select:none;
    }
    .iconBtn:hover{ opacity:.85; }

    /* ====== Tablero columnas ====== */
    .board{
      margin-top: 16px;
      display:flex;
      gap: 16px;
      overflow:auto;
      padding: 6px 2px 14px;
    }

    .col{
      flex: 0 0 auto;
      width: 270px;
      border-radius: 18px;
      background: var(--panel2);
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 34px rgba(139,74,100,.10);
      padding: 12px;
    }

    .colHead{
      text-align:center;
      padding: 8px 10px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,.55);
      border: 1px solid rgba(139,74,100,.10);
      margin-bottom: 12px;
      font-size: 13px;
      font-weight: 850;
      color: var(--title);
      letter-spacing:.3px;
    }

    .stack{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .course{
      padding: 10px 12px;
      border-radius: 14px;
      background: var(--pill);
      border: 1px solid var(--pillBorder);
      box-shadow: 0 10px 20px rgba(139,74,100,.10);
      cursor:pointer;
      transition: transform .15s ease, opacity .15s ease, border-color .15s ease;
      line-height: 1.2;
      font-size: 12.5px;
      font-weight: 750;
      color: #6b3a52;
      text-align:center;
      user-select:none;
    }

    .course:hover{
      transform: translateY(-1px);
      border-color: rgba(139,74,100,.35);
      opacity: .92;
    }

    .course.done{
      background: var(--doneBg);
      border-color: var(--doneBorder);
      text-decoration: line-through;
      text-decoration-thickness: 2px;
      text-decoration-color: rgba(139,74,100,.55);
      opacity: .70;
    }

    .board::-webkit-scrollbar{ height: 10px; }
    .board::-webkit-scrollbar-thumb{
      background: rgba(139,74,100,.22);
      border-radius: 999px;
    }
    .board::-webkit-scrollbar-track{
      background: rgba(255,255,255,.35);
      border-radius: 999px;
    }

    @media (max-width: 520px){
      .col{ width: 240px; }
      .pct{ min-width: 40px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="progressWrap">
        <div class="progressTrack" aria-label="Progreso">
          <div class="progressFill" id="progressFill"></div>
        </div>
        <div class="pct" id="pct">0%</div>
      </div>

      <div class="iconBtn" id="reset" title="Reset">üóëÔ∏è</div>
    </header>

    <div class="board" id="board"></div>
  </div>

<script>
  const storeKey = "malla_board_semestres_v2";
  let data;
  let aprobadas = new Set(JSON.parse(localStorage.getItem(storeKey) || "[]"));

  function save(){
    localStorage.setItem(storeKey, JSON.stringify([...aprobadas]));
  }

  // A1S1 => 1, A1S2 => 2, A2S1 => 3, A2S2 => 4, etc.
  function semesterIndexFromId(id){
    const m = String(id).match(/A(\d)S([12])/);
    if(!m) return null;
    const year = Number(m[1]);
    const sem  = Number(m[2]);
    return (year - 1) * 2 + sem;
  }

  function updateProgress(totalCourses){
    const done = aprobadas.size;
    const pct = totalCourses ? Math.round((done / totalCourses) * 100) : 0;
    document.getElementById("pct").textContent = `${pct}%`;
    document.getElementById("progressFill").style.width = `${pct}%`;
  }

  function render(){
    const board = document.getElementById("board");
    board.innerHTML = "";

    // Agrupar por semestre N
    const groups = new Map(); // key: N -> subjects[]
    const allCourses = [];

    data.subjects.forEach(s=>{
      const idx = semesterIndexFromId(s.id);
      if(idx === null) return; // ignora items sin formato AXSY
      allCourses.push(s);
      if(!groups.has(idx)) groups.set(idx, []);
      groups.get(idx).push(s);
    });

    updateProgress(allCourses.length);

    const keys = [...groups.keys()].sort((a,b)=>a-b);

    keys.forEach(idx=>{
      const col = document.createElement("div");
      col.className = "col";

      col.innerHTML = `
        <div class="colHead">${idx}¬∞ Semestre</div>
        <div class="stack"></div>
      `;

      const stack = col.querySelector(".stack");

      groups.get(idx)
        .slice()
        .sort((a,b)=> a.id.localeCompare(b.id))
        .forEach(subj=>{
          const btn = document.createElement("div");
          btn.className = "course";
          btn.textContent = subj.name;

          if(aprobadas.has(subj.id)) btn.classList.add("done");

          btn.addEventListener("click", ()=>{
            if(aprobadas.has(subj.id)) aprobadas.delete(subj.id);
            else aprobadas.add(subj.id);
            save();
            render();
          });

          stack.appendChild(btn);
        });

      board.appendChild(col);
    });
  }

  document.getElementById("reset").addEventListener("click", ()=>{
    if(confirm("¬øResetear materias rendidas?")){
      aprobadas = new Set();
      save();
      render();
    }
  });

  async function init(){
    data = await fetch("./data.json").then(r=>r.json());
    render();
  }

  init();
</script>
</body>
</html>
