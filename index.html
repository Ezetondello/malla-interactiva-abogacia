<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Malla</title>

<style>
:root{
  --rosaPastel1:#fde7f0;
  --rosaPastel2:#f9d6e5;
  --rosaTexto:#8b4a64;
  --texto:#4a3a45;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background: linear-gradient(180deg, var(--rosaPastel1) 0%, var(--rosaPastel2) 100%);
  color: var(--texto);
}

.wrap{
  max-width:900px;
  margin:60px auto;
  padding:0 20px;
}

/* ELIPSE */
.oval{
  position: relative;
  padding: 60px 60px;
  margin: 0 auto;
  max-width: 760px;
}

.oval::before{
  content:"";
  position:absolute;
  inset: 0;
  background: rgba(255,255,255,.55);
  border: 1px solid rgba(139,74,100,.18);
  border-radius: 50% / 28%;
  box-shadow: 0 22px 60px rgba(139,74,100,.15);
  z-index: 0;
}

.oval > *{
  position: relative;
  z-index: 1;
}

h1{
  text-align:center;
  font-size:18px;
  color:var(--rosaTexto);
  font-weight:600;
  margin-bottom:40px;
}

.semestre{
  margin-bottom:36px;
}

.semestre h2{
  font-size:14px;
  font-weight:700;
  color:var(--rosaTexto);
  margin-bottom:16px;
  letter-spacing:.5px;
}

.materia{
  padding:8px 0;
  font-size:14px;
  cursor:pointer;
  transition:opacity .2s ease;
}

.materia:hover{
  opacity:.7;
}

.aprobada{
  text-decoration: line-through;
  text-decoration-thickness: 2px;
  opacity:.6;
}

@media (max-width: 700px){
  .oval{
    padding: 40px 30px;
  }
  .oval::before{
    border-radius: 50% / 24%;
  }
}
</style>
</head>

<body>
<div class="wrap">

<div class="oval">
  <h1 id="career">Mi camino académico</h1>
  <div id="content"></div>
</div>

</div>

<script>
const storeKey = "malla_minimal_v2";
let data, aprobadas = JSON.parse(localStorage.getItem(storeKey) || "[]");

function save(){
  localStorage.setItem(storeKey, JSON.stringify(aprobadas));
}

function getSemesterFromId(id){
  const m = String(id).match(/A(\d)S([12])/);
  return m ? `Año ${m[1]} · ${m[2]}° semestre` : "Otros";
}

function render(){
  const content = document.getElementById("content");
  content.innerHTML = "";

  const groups = {};

  data.subjects.forEach(s=>{
    const key = getSemesterFromId(s.id);
    if(!groups[key]) groups[key]=[];
    groups[key].push(s);
  });

  Object.keys(groups).forEach(sem=>{
    const section = document.createElement("div");
    section.className="semestre";

    section.innerHTML=`<h2>${sem}</h2>`;

    groups[sem].forEach(subj=>{
      const div = document.createElement("div");
      div.className="materia";
      if(aprobadas.includes(subj.id)){
        div.classList.add("aprobada");
      }

      div.textContent=subj.name;

      div.addEventListener("click",()=>{
        if(aprobadas.includes(subj.id)){
          aprobadas = aprobadas.filter(id=>id!==subj.id);
        } else {
          aprobadas.push(subj.id);
        }
        save();
        render();
      });

      section.appendChild(div);
    });

    content.appendChild(section);
  });
}

async function init(){
  data = await fetch("./data.json").then(r=>r.json());
  document.getElementById("career").textContent = data.career || "Mi malla";
  render();
}

init();
</script>

</body>
</html>
